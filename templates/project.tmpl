<% c++ #include "data/tmpl_project.h" %>
<% skin defskin %>
<% view SingleProject uses Data::SingleProject %>
<% template page_main() %><% end %>
<% template page_footer() %><% end %>
<% template page_left_sidebar() %><% end %>
<% template render() %>
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <link href="/media/css/style.css" rel="stylesheet">
    </head>
<body>
<div class="wrapper">
    <header class="header">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="collapse navbar-collapse justify-content-center" id="navbarText">
                <ul class="navbar-nav mr-auto">
                    <% foreach menuItem in page.menuList %>
                        <% item %>
                            <li class="nav-item active">
                                <a class="nav-link" href="<%= menuItem.first %>">
                                <%= menuItem.second %>
                                </a>
                            </li>
                        <% end %>
                    <% end %>
                    <li class="nav-item active">
                        <a class="nav-link">
                            <%= page.current_username %>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </header>
    <div class="middle">
        <h1>
            <%= project_page.project.name %>
        </h1>
        <% if (content.project_page.is_employee) %>
            <% if (content.project_page.is_bid_created) %>
                <% if (content.project_page.bids[0].state->str() == "approved") %>
                    <button type="button" class="btn btn-outline-success" disabled>Approved</button>
                <% elif (content.project_page.bids[0].state->str() == "rejected") %>
                    <button type="button" class="btn btn-outline-danger" disabled>Rejected</button>
                <% else %>
                    <button type="button" class="btn btn-outline-warning" disabled>Considering</button>
                <% end %>
            <% else %>
                <a role="button" class="btn btn-success" href="/projects/bid_on/<%= project_page.project.id %>"> Bid on </a>
            <% end %>
        <% end %>
        <% if (!content.project_page.is_employee) %>
            <table style="min-width: 100%">
                <tbody>
                    <th style="width: 50%">
                        <div>
                            <div class="p-3 mb-2 bg-info-subtle text-info-emphasis">
                                <h2> Bids </h2>
                            </div>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th scope="col"> id </th>
                                        <th scope="col"> status </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% foreach bid in project_page.bids %>
                                        <% item %>
                                            <tr>
                                                <td><%= bid.id %></td>
                                                <% if (bid.state->str() == "considering") %>
                                                    <td>
                                                        <div class="btn-group">
                                                            <a role="button" class="btn btn-success" href="/projects/<%= bid.id %>/approve"> Approve </a>
                                                            <a role="button" class="btn btn-danger" href="/projects/<%= bid.id %>/reject"> Reject </a>
                                                        </div>
                                                    </td>
                                                <% elif (bid.state->str() == "approved") %>
                                                    <td>
                                                        <button type="button" class="btn btn-outline-success" disabled> Approved </button>
                                                    </td>
                                                <% else %>
                                                    <td>
                                                        <button type="button" class="btn btn-outline-danger" disabled> Rejected </button>
                                                    </td>
                                                <% end %>
                                            </tr>
                                        <% end %>
                                    <% end %>
                                </tbody>
                            </table>
                        </div>
                    </th>
                    <th class="align-top">
                        <p class="text-body-secondary">
                            Current status:
                            <% if (content.project_page.project.state->integer() == 0) %>
                                is not started
                                <a role="button" class="btn btn-success" href="/projects/advance/<%= project_page.project.id %>"> Advance </a>
                            <% elif (content.project_page.project.state->integer() == 1) %>
                                is preparing
                                <a role="button" class="btn btn-success" href="/projects/advance/<%= project_page.project.id %>"> Advance </a>
                            <% elif (content.project_page.project.state->integer() == 2) %>
                                is processing
                                <a role="button" class="btn btn-success" href="/projects/advance/<%= project_page.project.id %>"> Advance </a>
                            <% elif (content.project_page.project.state->integer() == 3) %>
                                is completed
                            <% end %>
                        </p>
                    </th>
                </tbody>
            </table>
        <% end %>
    </div>
</div>
<footer class="footer"><% include page_footer() %></footer>
</body>
</html>
<% end template %>
<% end view %>
<% end skin %>